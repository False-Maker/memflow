# MemFlow 项目整体测试与功能验证 Prompt

## 测试目标

对 MemFlow 项目进行全面的功能测试和完整性验证，确保：
1. **核心功能完整性**：所有已实现的功能模块正常工作
2. **系统稳定性**：长时间运行无崩溃、内存泄漏等问题
3. **数据一致性**：数据库操作、文件管理、索引维护正确无误
4. **用户体验**：界面交互流畅，错误提示清晰
5. **性能表现**：资源占用合理，响应速度可接受

## 测试范围

### 1. 核心功能模块测试

#### 1.1 数据库系统
- [ ] 数据库初始化与迁移
  - 首次启动时数据库文件正确创建
  - 所有迁移文件（0001-0007）成功执行
  - FTS5 全文检索索引正常创建
  - WAL 模式配置生效，支持并发读写
- [ ] 数据库操作
  - 活动记录插入、查询、更新正常
  - 向量嵌入存储与检索正常
  - 知识图谱节点和边存储正常
  - 聊天记录和反馈数据持久化正常
  - 统计数据正确更新

#### 1.2 截图录制系统
- [ ] 基础录制功能
  - 周期性截图正常执行（按配置间隔）
  - 应用窗口信息正确获取（窗口标题、进程名）
  - 截图文件正确保存到指定目录
  - pHash 感知哈希计算正确
  - 智能去重功能生效（相同 pHash 跳过保存）
- [ ] 录制配置
  - 录制间隔配置生效
  - 暂停/恢复录制功能正常
  - 录制状态正确显示在 UI

#### 1.3 OCR 文本提取系统
- [ ] OCR 引擎切换
  - Windows OCR 和 RapidOCR 引擎可正常切换
  - 引擎配置正确保存和加载
  - 引擎切换后 OCR 处理正常
- [ ] OCR 处理流程
  - 图像预处理（灰度化、二值化、对比度增强）正常
  - OCR 文本提取准确
  - PII 隐私脱敏功能生效（手机号、身份证、银行卡、邮箱）
  - OCR 结果正确存储到数据库
  - FTS5 索引正确更新
- [ ] OCR 错误处理
  - OCR 失败时错误信息清晰
  - 重试机制正常工作（3次重试）
  - OCR 服务异常时不影响录制

#### 1.4 AI 分析系统
- [ ] 向量数据库
  - 向量嵌入存储正常
  - 余弦相似度计算正确
  - 相似度搜索返回相关结果
- [ ] RAG 混合检索
  - BM25 关键词检索（FTS5）正常
  - 向量语义检索正常
  - 结果合并和加权正确
- [ ] AI 对话功能
  - 上下文检索正常
  - 活动分析功能可用
  - 回答质量可接受（如已集成 LLM）

#### 1.5 知识图谱系统
- [ ] 图谱构建
  - 实体提取正确（应用、时间段、文档关键词）
  - 关系构建正确（应用-时间段、应用-文档）
  - 节点大小计算合理
- [ ] 图谱持久化
  - 图谱数据正确保存到数据库
  - 从数据库加载图谱数据正常
- [ ] 图谱可视化
  - 前端图谱渲染正常（React Force Graph 2D）
  - 图谱数据动态加载正常
  - 重建图谱功能可用
  - Web Worker 布局计算不阻塞 UI

#### 1.6 性能监控系统
- [ ] 性能指标统计
  - 内存使用统计准确
  - 磁盘使用统计准确
  - 活动统计正确（截图数、活动记录数）
- [ ] 垃圾回收功能
  - 过期数据清理正确（基于保留天数）
  - 孤立文件清理正常
  - SQLite VACUUM 执行成功
- [ ] 性能监控界面
  - 实时指标显示正常
  - 手动触发 GC 功能可用
  - 自动刷新正常

#### 1.7 配置管理系统
- [ ] 配置持久化
  - 配置正确保存到 JSON 文件
  - 配置初始化正确
  - 配置更新和保存正常
- [ ] 配置热加载
  - 配置修改后无需重启即可生效
  - 默认配置设置正确

#### 1.8 安全存储系统
- [ ] Keyring 集成
  - Windows Credential Locker 支持正常
  - API Key 安全存储和获取正常
  - 密钥删除功能正常

### 2. 前端界面测试

#### 2.1 主要组件
- [ ] Layout 主布局
  - 导航菜单正常
  - 视图切换正常
  - 响应式布局适配
- [ ] Timeline 时间轴视图
  - 活动记录正确显示
  - 图片加载和显示正常
  - 时间轴滚动流畅
  - 虚拟化列表性能良好
- [ ] KnowledgeGraph 知识图谱
  - 图谱可视化正常
  - 节点交互正常（拖拽、缩放）
  - 图谱数据加载正常
- [ ] FlowState 统计面板
  - 统计数据正确显示
  - 图表渲染正常（Recharts）
- [ ] 弹窗组件
  - AgentHistoryModal、AgentProposalModal
  - ChatHistoryModal、FeedbackModal
  - ImagePreviewModal、SettingsModal
  - PerformanceModal、MessageRating
  - 所有弹窗打开/关闭正常，功能可用

#### 2.2 用户交互
- [ ] 设置界面
  - 所有配置项可正常修改
  - OCR 引擎切换正常
  - 配置保存生效
- [ ] 错误处理
  - 错误提示清晰友好
  - 网络错误、文件错误等异常情况处理正确

### 3. 系统集成测试

#### 3.1 端到端流程
- [ ] 完整录制流程
  1. 启动应用 → 数据库初始化成功
  2. 开始录制 → 截图正常保存
  3. OCR 处理 → 文本提取和存储正常
  4. 查看时间线 → 活动记录正确显示
  5. 搜索活动 → FTS5 检索正常
  6. 问答功能 → AI 分析正常（如已配置）
  7. 查看图谱 → 图谱构建和显示正常
- [ ] 数据一致性
  - 活动记录与截图文件一一对应
  - OCR 文本与活动记录关联正确
  - 向量嵌入与活动记录关联正确
  - 图谱节点与活动记录关联正确

#### 3.2 长时间运行测试
- [ ] 稳定性测试
  - 连续运行 2-4 小时无崩溃
  - 内存占用稳定（无内存泄漏）
  - CPU 占用合理
  - 磁盘 I/O 正常
- [ ] 性能测试
  - 大量数据（1000+ 活动记录）下查询性能可接受
  - 图谱渲染大量节点时性能可接受
  - 时间轴滚动流畅

### 4. 边界情况与异常测试

#### 4.1 异常情况处理
- [ ] 数据库损坏恢复
  - 数据库文件损坏时自动检测和恢复
  - 损坏检测逻辑正确
- [ ] 文件系统异常
  - 截图目录权限不足时错误提示清晰
  - 磁盘空间不足时正确处理
- [ ] OCR 服务异常
  - RapidOCR 可执行文件不存在时错误提示清晰
  - OCR 服务启动失败时正确处理
- [ ] 网络异常（如使用 LLM API）
  - API 调用失败时错误处理正确
  - 超时重试机制正常

#### 4.2 边界值测试
- [ ] 空数据情况
  - 无活动记录时界面正常显示
  - 无 OCR 文本时搜索正常
  - 空图谱时可视化正常
- [ ] 大数据量情况
  - 10000+ 活动记录时性能可接受
  - 大量截图文件时加载正常

### 5. 功能完整性检查

#### 5.1 已实现功能验证（基于 PROGRESS.md）
- [ ] ✅ 数据库系统（100%）
- [ ] ✅ 截图录制系统（100%）
- [ ] ✅ OCR 文本提取系统（98%，RapidOCR Sidecar 已集成）
- [ ] ⚠️ AI 分析系统（75%，框架完成，需集成 LLM 和嵌入模型）
- [ ] ✅ 知识图谱系统（90%）
- [ ] ✅ 性能监控系统（90%）
- [ ] ✅ 前端界面（95%）
- [ ] ✅ 配置管理（100%）
- [ ] ✅ 安全存储（100%）

#### 5.2 待完善功能检查（基于设计文档）
- [ ] 应用黑名单/白名单功能（P0）
- [ ] 临时隐私模式（P0）
- [ ] 时间线一站式搜索与过滤（P0）
- [ ] 问答可解释性与溯源（P1）
- [ ] 数据生命周期闭环（P1）
- [ ] 后台任务队列化（P1）
- [ ] 每日/每周摘要（P2）
- [ ] 导出/备份功能（P2）

## 测试步骤

### 阶段 1：环境准备
1. 检查开发环境
   ```bash
   pnpm test:setup
   ```
2. 确认依赖安装完整
   - Node.js 18+ 和 pnpm
   - Rust 1.70+
   - Tauri CLI 2.0
3. 下载 RapidOCR（如使用）
   ```bash
   pnpm download:rapidocr
   ```

### 阶段 2：基础功能测试
1. 启动应用
   ```bash
   pnpm tauri:dev
   ```
2. 检查数据库初始化
   - 查看终端日志，确认迁移成功
   - 检查数据库文件是否创建
   - 验证表结构正确
3. 测试录制功能
   - 开始录制，观察截图是否正常保存
   - 检查活动记录是否正确写入数据库
   - 验证去重功能是否生效
4. 测试 OCR 功能
   ```bash
   pnpm test:ocr
   ```
   - 验证 OCR 文本提取正常
   - 检查 PII 脱敏是否生效
   - 确认 OCR 结果存储到数据库

### 阶段 3：高级功能测试
1. 测试搜索功能
   - 在时间线中搜索关键词
   - 验证 FTS5 检索正常
   - 测试条件筛选功能
2. 测试 AI 功能（如已配置）
   - 测试问答功能
   - 验证 RAG 检索正常
   - 检查上下文检索正确
3. 测试知识图谱
   - 触发图谱构建
   - 验证图谱可视化正常
   - 测试图谱交互功能
4. 测试性能监控
   - 查看性能指标
   - 测试垃圾回收功能
   - 验证统计数据准确

### 阶段 4：集成测试
1. 端到端流程测试
   - 完整执行一次从录制到查看的流程
   - 验证数据一致性
   - 检查各模块协同工作正常
2. 长时间运行测试
   - 连续运行 2-4 小时
   - 监控内存和 CPU 占用
   - 检查是否有崩溃或错误

### 阶段 5：异常测试
1. 测试异常情况处理
   - 模拟数据库损坏
   - 测试文件权限不足
   - 测试 OCR 服务异常
2. 测试边界情况
   - 空数据情况
   - 大数据量情况

## 验收标准

### 必须通过（P0）
- ✅ 数据库初始化和迁移 100% 成功
- ✅ 截图录制功能正常工作
- ✅ OCR 文本提取功能正常（至少一种引擎）
- ✅ 活动记录正确显示在时间线
- ✅ 基础搜索功能可用
- ✅ 应用可长时间运行无崩溃

### 应该通过（P1）
- ✅ 知识图谱构建和可视化正常
- ✅ 性能监控功能正常
- ✅ AI 功能框架可用（如已配置 LLM）
- ✅ 配置管理功能正常
- ✅ 错误处理清晰友好

### 可选通过（P2）
- ⚠️ 高级搜索和过滤功能
- ⚠️ 隐私模式功能
- ⚠️ 数据导出功能
- ⚠️ 每日摘要功能

## 测试报告模板

### 测试结果汇总
- **测试日期**：YYYY-MM-DD
- **测试环境**：Windows 10/11, Node.js X.X, Rust X.X
- **总体通过率**：XX%
- **严重问题数**：X
- **一般问题数**：X
- **建议改进数**：X

### 功能测试结果
| 功能模块 | 测试项 | 状态 | 备注 |
|---------|--------|------|------|
| 数据库系统 | 初始化与迁移 | ✅/❌ | |
| 数据库系统 | 数据操作 | ✅/❌ | |
| 截图录制 | 基础录制 | ✅/❌ | |
| OCR 系统 | 文本提取 | ✅/❌ | |
| ... | ... | ... | ... |

### 发现的问题
1. **问题描述**
   - 严重程度：高/中/低
   - 复现步骤：...
   - 预期行为：...
   - 实际行为：...
   - 建议修复：...

### 性能测试结果
- **内存占用**：XX MB（峰值）
- **CPU 占用**：XX%（平均）
- **磁盘占用**：XX MB
- **响应时间**：XX ms（关键操作）

### 功能完整性评估
- **已实现功能完成度**：XX%
- **待完善功能优先级**：P0/P1/P2
- **建议下一步工作**：...

## 使用说明

将此 Prompt 提供给 AI 助手或测试人员，按照以下步骤执行：

1. **阅读项目文档**：了解项目架构和功能范围
2. **执行测试步骤**：按照阶段 1-5 逐步测试
3. **记录测试结果**：使用测试报告模板记录
4. **生成测试报告**：汇总所有测试结果和问题
5. **提出改进建议**：基于测试结果提出优化建议

---

**提示**：测试过程中如遇到问题，请：
1. 查看应用日志（终端输出）
2. 检查数据库文件完整性
3. 验证配置文件正确性
4. 参考 `DEVELOPMENT.md` 和 `PROGRESS.md` 文档

