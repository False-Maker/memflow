# MemFlow 日志查看指南

## 日志位置

根据代码实现，日志会输出到两个位置：

### 1. 终端输出（开发模式）
- 在运行 `pnpm tauri:dev` 的终端窗口中查看
- 日志会实时输出到 stderr
- 包含所有 INFO、WARN、ERROR 级别的日志

### 2. 日志文件
- **路径**：`%LOCALAPPDATA%\com.memflow.app\logs\memflow.log`
- **格式**：按天轮转（daily rolling）
- **编码**：UTF-8

## 当前状态

根据检查结果：
- ❌ 日志目录不存在：`%LOCALAPPDATA%\com.memflow.app\logs\`
- ❌ 日志文件不存在：`memflow.log`
- ❌ 配置文件不存在：`config.json`
- ❌ 数据库文件不存在：`memflow.db`

**说明**：应用可能刚启动，尚未完成初始化，或者应用尚未运行。

## 如何查看日志

### 方法 1：查看终端输出（推荐）
1. 找到运行 `pnpm tauri:dev` 的终端窗口
2. 查看终端中的日志输出
3. 关键日志包括：
   - `Logging directory: ...` - 日志目录路径
   - `Starting database initialization...` - 数据库初始化开始
   - `Database initialization completed successfully.` - 数据库初始化成功
   - `Starting OCR service...` - OCR 服务启动
   - `Starting recording_loop...` - 录制循环开始

### 方法 2：查看日志文件
等待应用运行一段时间后，日志文件会被创建。使用以下命令查看：

```powershell
# 查看最新日志（最后50行）
Get-Content "$env:LOCALAPPDATA\com.memflow.app\logs\memflow.log" -Tail 50 -Encoding UTF8

# 查看所有日志
Get-Content "$env:LOCALAPPDATA\com.memflow.app\logs\memflow.log" -Encoding UTF8

# 实时监控日志（类似 tail -f）
Get-Content "$env:LOCALAPPDATA\com.memflow.app\logs\memflow.log" -Wait -Tail 20 -Encoding UTF8
```

## 关键日志信息

### 应用启动日志
查找以下关键信息：
- ✅ `Logging directory: ...` - 确认日志目录创建成功
- ✅ `Starting database initialization...` - 数据库初始化开始
- ✅ `开始执行数据库迁移...` - 迁移开始
- ✅ `数据库迁移执行成功` - 迁移成功
- ✅ `数据库完整性检查通过` - 完整性检查通过
- ✅ `Database initialization completed successfully.` - 初始化完成

### 录制功能日志
- ✅ `Starting recording_loop...` - 录制循环开始
- ✅ `Loaded config for recording: interval=5000ms` - 配置加载成功
- ✅ `Entering recording loop while loop...` - 进入录制循环
- ⚠️ `截图录制失败` - 录制失败（需要检查错误信息）

### OCR 功能日志
- ✅ `Starting OCR service...` - OCR 服务启动
- ⚠️ `OCR service failed to start: ...` - OCR 服务启动失败
- ✅ `使用 RapidOCR 引擎` - OCR 引擎选择
- ⚠️ `OCR 处理失败` - OCR 处理失败

### 错误日志
查找以下错误信息：
- ❌ `CRITICAL: Database init failed: ...` - 数据库初始化失败
- ❌ `CRITICAL: Config init failed: ...` - 配置初始化失败
- ❌ `数据库损坏检测: ...` - 数据库损坏
- ❌ `数据库恢复失败: ...` - 数据库恢复失败

## 日志级别

根据代码，日志级别由环境变量 `RUST_LOG` 控制：
- 默认：`info` 级别
- 可设置：`debug`、`trace` 等更详细级别

设置方法：
```powershell
$env:RUST_LOG="debug"
pnpm tauri:dev
```

## 建议

1. **查看终端输出**：最直接的方法，实时查看日志
2. **等待应用初始化**：应用启动后，等待几秒钟让初始化完成
3. **检查日志文件**：如果应用已运行一段时间，检查日志文件
4. **启用详细日志**：如需调试，设置 `RUST_LOG=debug`

---

*最后更新：2025-01-27*

