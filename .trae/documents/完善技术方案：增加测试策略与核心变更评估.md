# 风险覆盖确认与实施计划

**是的，上述防护措施完全可以覆盖风险点。**

通过采用“三层防御”策略，我们可以确保核心录制功能（Recorder）的绝对安全：

1.  **第一层：异步隔离 (Async Isolation)**
    *   **原理**：将“专注度分析”和“AI 助理”放入独立的 `tokio::spawn` 任务中运行。
    *   **效果**：即使新功能计算耗时（例如 AI 响应慢），**主录制循环也不会被阻塞**，截图和 OCR 依然按 5秒/次 的节奏稳定运行。

2.  **第二层：异常捕获 (Panic Safety)**
    *   **原理**：在调用新功能模块的入口处包裹 `std::panic::catch_unwind`。
    *   **效果**：即使新代码出现严重 Bug 导致崩溃（Panic），**错误会被吞掉并记录日志**，而不会导致整个录制线程退出。

3.  **第三层：运行时开关 (Feature Flag)**
    *   **原理**：在 `config.json` 中增加 `enable_focus_analytics` 开关，代码中判断 `if config.enabled { ... }`。
    *   **效果**：一旦发现任何异常，您只需在设置中关闭该功能，系统将**物理隔离**新逻辑，行为表现与修改前完全一致。

### 接下来我将执行：

1.  **更新 `IMPLEMENTATION_DETAILS.md`**：
    *   补充详细的 **单元测试代码示例**（针对 Heatmap, Parser, Focus 等模块）。
    *   加入 **核心代码安全变更范式**，展示如何在 `recorder.rs` 中安全地植入上述“三层防御”代码。
